{% extends "base.html" %}
{% load static %}

{% block title %}ì‚¬ë¬¼ì¸í„°ë„· ê²Œì‹œíŒ{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'board.css' %}">
{% endblock %}

{% block content %}

<main>

    <div class="postname-header">
        <h1>ğŸ“¡ ì‚¬ë¬¼ì¸í„°ë„· ê²Œì‹œíŒ</h1>

        <!-- ìƒˆ ê¸€ ì‘ì„± ë²„íŠ¼ (Django URL ì‚¬ìš©) -->
        <a href="{% url 'board:post_create' %}" class="write-button">
            ìƒˆ ê¸€ ì‘ì„±
            <svg width="22" height="22" viewBox="0 0 22 22">
                <circle cx="11" cy="11" r="10" stroke="#0217C2" stroke-opacity="0.5" stroke-width="2.5"/>
                <path d="M11 7v8M7 11h8" stroke="#0217C2" stroke-opacity="0.5" stroke-width="2.5" stroke-linecap="round"/>
            </svg>
        </a>
    </div>

    <!-- ê²Œì‹œê¸€ ëª©ë¡ -->
    <div id="board-list"></div>

</main>

<script>
    function loadBoardList() {
        fetch("/api/board/?category=ì‚¬ë¬¼ì¸í„°ë„·")
            .then(res => res.json())
            .then(data => {

                const list = document.getElementById("board-list");
                list.innerHTML = "";

                data.board_list.forEach(post => {

                    const card = document.createElement("div");
                    card.className = "post-card";

                    const preview = post.content.length > 50 ? post.content.slice(0, 50) + "..." : post.content;
                    const author = post.anonymous ? "ìµëª…" : post.user;

                    card.innerHTML = `
                        <span class="post-category">${post.category} ê²Œì‹œíŒ</span>
                        <div class="post-title">${post.title}</div>
                        <div class="post-content">${preview}</div>

                        <div class="post-meta">
                            <span>ğŸ‘ ${post.like_count || 0}</span>
                            <span>ğŸ’¬ ${post.comment_count || 0}</span>
                            <span>${post.date}</span>
                            <span>${author}</span>
                        </div>
                    `;

                    card.addEventListener("click", () => {
                        window.location.href = "/board/" + post.id + "/";
                    });

                    list.prepend(card);
                });
            });
    }

    loadBoardList();
</script>

{% endblock %}
